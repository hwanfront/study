# 4. 테스트 구축하기
- 리팩터링을 제대로 하려면 견고한 test suite가 뒷받침돼야 한다.
- 좋은 테스트를 작성하는 일은 개발 효율을 높여준다.
## 4.1 자가 테스트 코드의 가치
## 4.2 테스트할 샘플 코드
- main.js
- Producer.js
- Province.js
## 4.3 첫 번째 테스트
- test.spec.js
- 실패해야 할 상황에서는 반드시 실패하게 만들자.
- 자주 테스트하라.
- 실패한 테스트가 하나라도 있으면 리팩터링하면 안 된다.
## 4.4 테스트 추가하기
- 완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는 게 낫다.
- '테스트끼리 상호작용하게 하는 공유 픽스처'를 생성하지 않는다.
```js
describe('province', function() {
  const asia = new Province(sampleProvinceData()); // 공유 픽스처 사용 안됌!!
  it(...) 
  it(...)
});
```
## 4.5 픽스처 수정하기
- `준비 arrange`-`수행 act`-`단언 assert`
  - `설정 setup`-`실행 exercise`-`검증 verify` 또는 `조건 given`-`발생 when`-`결과 then` 등으로 불림
- 한 테스트 안에 세 단계가 모두 있을 수도 있고, 초기 작업 공통부분을 표준 설정 루틴 (beforeEach 등)에 모아서 처리하기도 한다.
- 일반적으로 it 구문 하나당 검증도 하나씩만 하는 게 좋다.
## 4.6 경계 조건 검사하기
- 경계를 확인하는 테스트를 작성해보면 특이 상황을 어떻게 처리하는 게 좋을지 생각해볼 수 있다.
- 문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 부분을 집중적으로 테스트한다.
- 같은 코드베이스의 모듈 사이에 유효성 검사 코드가 너무 많으면 다른 곳에서 확인한 걸 중복으로 검증하여 오히려 문제가 될 수 있다.
- JSON 인코딩된 요청처럼 외부에서 들어온 입력 객체는 유효한지 확인해봐야 하므로 테스트를 작성한다.
- 리팩터링은 겉보기 동작에 영향을 주지 않아야 한다.
- 프로그램 내부에 잘못된 데이터가 흘러서 디버깅하기 어려운 문제가 발생한다면 **어서션 추가하기(10.6)**를 적용해 오류를 빨리 드러나게 한다.
- 버그 없는 완벽한 프로그램은 없다. 처리 과정이 복잡한 부분과 같은 위험한 부분에 집중하는 게 좋다.
- 테스트가 모든 버그를 걸러주지는 못해도 안심하고 리팩터링할 수 있는 보호막은 되어준다.
## 어서션
- 항상 참이라고 가정하는 조건부 문장이다.
- 시스템 운영에 영향을 주지 않으며 어서션을 추가한다고 해서 동작이 달라지지 않는다.
- 어서션은 오류 찾기 뿐만 아니라 프로그램이 어떤 상태임을 가정한 채 실행되는지를 다른 개발자에게 알려주는 소통 도구이다.
- 어서션도 일종의 테스트로 볼 수 있으므로 테스트 코드를 따로 작성할 필요는 없다.
## 4.7 ㄱ끝나지 않은 여정
- 테스트는 리팩터링에 반드시 필요한 토대일 뿐만 아니라 그 자체로도 프로그래밍에 중요한 역할을 한다.
- 예시와 같은 단위테스트 뿐만 아니라 다양한 테스트 유형이 있다.
- 버그를 발견하는 즉시 발견한 버그를 명확히 잡아내는 테스트부터 작성한다.
- 충분히 테스트를 했다고 할 명확한 기준은 없지만 테스트 때문에 개발 속도가 느려진다고 생각되면 테스트를 과하게 작성한 건 아닌지 의심해보자.
